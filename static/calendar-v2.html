<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Semptify Calendar - Track important dates and deadlines">
  <title>Calendar - Semptify</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="/static/css/design-system.css">
  <link rel="stylesheet" href="/static/css/layouts.css">
  <link rel="stylesheet" href="/static/css/help-system.css">

  <a href="#main-content" class="skip-link">Skip to main content</a>
</head>
<body>
  <div id="toast-container" class="toast-container"></div>
  <div id="a11y-announcer" class="sr-only" aria-live="polite"></div>

  <div class="app-layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-inner">
        <div class="sidebar-header">
          <a href="/" class="sidebar-brand">
            <div class="sidebar-logo-icon"><i class="fas fa-balance-scale"></i></div>
            <span class="sidebar-brand-text">Semptify</span>
          </a>
          <button class="sidebar-toggle btn btn-ghost btn-icon" id="sidebar-toggle">
            <i class="fas fa-bars"></i>
          </button>
        </div>
        <nav class="sidebar-nav">
          <ul class="sidebar-menu">
            <li class="sidebar-item">
              <a href="/static/dashboard-v2.html" class="sidebar-link">
                <i class="fas fa-home sidebar-icon"></i>
                <span class="sidebar-text">Dashboard</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a href="/static/documents-v2.html" class="sidebar-link">
                <i class="fas fa-file-alt sidebar-icon"></i>
                <span class="sidebar-text">Documents</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a href="/static/timeline-v2.html" class="sidebar-link">
                <i class="fas fa-stream sidebar-icon"></i>
                <span class="sidebar-text">Timeline</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a href="/static/calendar-v2.html" class="sidebar-link active" aria-current="page">
                <i class="fas fa-calendar sidebar-icon"></i>
                <span class="sidebar-text">Calendar</span>
              </a>
            </li>
            <li class="sidebar-divider"></li>
            <li class="sidebar-section"><span class="sidebar-section-title">Eviction Defense</span></li>
            <li class="sidebar-item">
              <a href="/eviction/" class="sidebar-link">
                <i class="fas fa-route sidebar-icon"></i>
                <span class="sidebar-text">Guided Flows</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a href="/eviction/forms/library" class="sidebar-link">
                <i class="fas fa-file-signature sidebar-icon"></i>
                <span class="sidebar-text">Form Library</span>
              </a>
            </li>
          </ul>
        </nav>
        <div class="sidebar-footer">
          <div class="sidebar-status" id="sync-status">
            <span class="status-indicator status-offline" id="status-dot"></span>
            <span class="sidebar-text" id="status-text">Offline</span>
          </div>
        </div>
      </div>
    </aside>

    <div class="main-wrapper">
      <!-- Header -->
      <header class="header">
        <div class="header-inner">
          <button class="header-menu-toggle btn btn-ghost btn-icon" id="mobile-menu-toggle">
            <i class="fas fa-bars"></i>
          </button>
          <div class="header-title">
            <h1 class="page-title">Calendar</h1>
          </div>
          <div class="header-actions">
            <button class="btn btn-ghost btn-icon" id="theme-toggle">
              <i class="fas fa-moon" id="theme-icon"></i>
            </button>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main id="main-content" class="main-content">
        <!-- Calendar Header -->
        <div class="page-header">
          <div class="page-header-title">
            <div class="calendar-nav">
              <button class="btn btn-ghost btn-icon" id="prev-month">
                <i class="fas fa-chevron-left"></i>
              </button>
              <h2 class="h2" id="current-month"></h2>
              <button class="btn btn-ghost btn-icon" id="next-month">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
            <div class="page-header-actions">
              <button class="btn btn-secondary" id="today-btn">Today</button>
              <button class="btn btn-primary" id="add-event-btn">
                <i class="fas fa-plus"></i>
                Add Event
              </button>
            </div>
          </div>
        </div>

        <div class="calendar-layout">
          <!-- Calendar Grid -->
          <div class="card calendar-card">
            <div class="calendar-header">
              <div class="calendar-day-header">Sun</div>
              <div class="calendar-day-header">Mon</div>
              <div class="calendar-day-header">Tue</div>
              <div class="calendar-day-header">Wed</div>
              <div class="calendar-day-header">Thu</div>
              <div class="calendar-day-header">Fri</div>
              <div class="calendar-day-header">Sat</div>
            </div>
            <div class="calendar-grid" id="calendar-grid">
              <!-- Days rendered by JavaScript -->
            </div>
          </div>

          <!-- Events Sidebar -->
          <div class="events-sidebar">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-calendar-day"></i>
                  <span id="selected-date-title">Today's Events</span>
                </h3>
              </div>
              <div class="card-body" id="events-list">
                <!-- Events rendered by JavaScript -->
              </div>
            </div>

            <div class="card mt-4">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-clock text-warning"></i>
                  Upcoming Deadlines
                </h3>
              </div>
              <div class="card-body" id="deadlines-list">
                <!-- Deadlines rendered by JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </main>

      <footer class="footer">
        <div class="footer-content">
          <p>&copy; 2024 Semptify. All rights reserved.</p>
          <p><span class="version-label">Version</span> <span class="version-number">5.0.0</span></p>
        </div>
      </footer>
    </div>
  </div>

  <!-- Add/Edit Event Modal -->
  <div class="modal-backdrop" id="event-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="modal-title">Add Event</h2>
        <button class="modal-close" onclick="closeEventModal()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <form id="event-form">
          <input type="hidden" id="event-id">
          <div class="form-group">
            <label class="form-label" for="event-title">Title *</label>
            <input type="text" id="event-title" class="form-input" required>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="event-date">Date *</label>
              <input type="date" id="event-date" class="form-input" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="event-time">Time</label>
              <input type="time" id="event-time" class="form-input">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" for="event-type">Type</label>
            <select id="event-type" class="form-select">
              <option value="deadline">Deadline</option>
              <option value="hearing">Court Hearing</option>
              <option value="meeting">Meeting</option>
              <option value="reminder">Reminder</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="event-description">Description</label>
            <textarea id="event-description" class="form-textarea" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="event-reminder">
              <span class="checkmark"></span>
              Send reminder notification
            </label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeEventModal()">Cancel</button>
        <button class="btn btn-primary" id="save-event-btn">
          <i class="fas fa-save"></i>
          Save Event
        </button>
      </div>
    </div>
  </div>

  <script src="/static/js/modules/api.js"></script>
  <script src="/static/js/modules/websocket.js"></script>
  <script src="/static/js/modules/ui.js"></script>
  <script src="/static/js/modules/state.js"></script>
  <script src="/static/js/app.main.js"></script>

  <style>
    .sidebar-logo-icon {
      width: 2rem;
      height: 2rem;
      background: linear-gradient(135deg, var(--color-primary-500), var(--color-primary-700));
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .calendar-nav {
      display: flex;
      align-items: center;
      gap: var(--space-4);
    }

    .calendar-layout {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: var(--space-6);
    }

    @media (max-width: 1024px) {
      .calendar-layout {
        grid-template-columns: 1fr;
      }
    }

    .calendar-card {
      overflow: hidden;
    }

    .calendar-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      background-color: var(--color-bg-secondary);
      border-bottom: 1px solid var(--color-border);
    }

    .calendar-day-header {
      padding: var(--space-3);
      text-align: center;
      font-weight: var(--font-weight-semibold);
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }

    .calendar-day {
      min-height: 100px;
      padding: var(--space-2);
      border-right: 1px solid var(--color-border);
      border-bottom: 1px solid var(--color-border);
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .calendar-day:nth-child(7n) {
      border-right: none;
    }

    .calendar-day:hover {
      background-color: var(--color-bg-secondary);
    }

    .calendar-day.other-month {
      background-color: var(--color-bg-tertiary);
      color: var(--color-text-muted);
    }

    .calendar-day.today {
      background-color: var(--color-primary-50);
    }

    .calendar-day.selected {
      background-color: var(--color-primary-100);
    }

    .calendar-day-number {
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--space-1);
    }

    .calendar-day.today .calendar-day-number {
      width: 1.75rem;
      height: 1.75rem;
      background-color: var(--color-primary-500);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .calendar-events {
      display: flex;
      flex-direction: column;
      gap: var(--space-1);
    }

    .calendar-event {
      font-size: var(--font-size-xs);
      padding: var(--space-1) var(--space-2);
      border-radius: var(--radius-sm);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
    }

    .calendar-event.deadline { background-color: var(--color-danger-100); color: var(--color-danger-700); }
    .calendar-event.hearing { background-color: var(--color-warning-100); color: var(--color-warning-700); }
    .calendar-event.meeting { background-color: var(--color-primary-100); color: var(--color-primary-700); }
    .calendar-event.reminder { background-color: var(--color-info-100); color: var(--color-info-700); }
    .calendar-event.other { background-color: var(--color-bg-tertiary); color: var(--color-text-secondary); }

    .calendar-event-more {
      font-size: var(--font-size-xs);
      color: var(--color-text-muted);
      padding: var(--space-1);
    }

    .events-sidebar .card-title {
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .event-item {
      display: flex;
      gap: var(--space-3);
      padding: var(--space-3);
      border-radius: var(--radius-md);
      transition: var(--transition-fast);
      cursor: pointer;
    }

    .event-item:hover {
      background-color: var(--color-bg-secondary);
    }

    .event-time {
      flex-shrink: 0;
      width: 60px;
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
    }

    .event-dot {
      flex-shrink: 0;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-top: 6px;
    }

    .event-dot.deadline { background-color: var(--color-danger-500); }
    .event-dot.hearing { background-color: var(--color-warning-500); }
    .event-dot.meeting { background-color: var(--color-primary-500); }
    .event-dot.reminder { background-color: var(--color-info-500); }
    .event-dot.other { background-color: var(--color-text-muted); }

    .event-content {
      flex: 1;
      min-width: 0;
    }

    .event-title {
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--space-1);
    }

    .event-desc {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .event-actions {
      opacity: 0;
      transition: var(--transition-fast);
    }

    .event-item:hover .event-actions {
      opacity: 1;
    }

    .deadline-item {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-3);
      border-radius: var(--radius-md);
      border-left: 3px solid var(--color-danger-500);
      background-color: var(--color-danger-50);
      margin-bottom: var(--space-2);
    }

    .deadline-icon {
      color: var(--color-danger-500);
    }

    .deadline-content {
      flex: 1;
    }

    .deadline-title {
      font-weight: var(--font-weight-medium);
    }

    .deadline-date {
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
    }

    .deadline-badge {
      font-size: var(--font-size-xs);
      padding: var(--space-1) var(--space-2);
      border-radius: var(--radius-full);
      background-color: var(--color-danger-500);
      color: white;
    }

    .empty-events {
      text-align: center;
      padding: var(--space-6);
      color: var(--color-text-muted);
    }

    .empty-events i {
      font-size: 2rem;
      margin-bottom: var(--space-3);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-4);
    }
  </style>

  <script>
    (function() {
      let events = [];
      let currentDate = new Date();
      let selectedDate = new Date();
      let editingEvent = null;

      window.addEventListener('semptify:ready', init);
      if (window.app?.isReady?.()) init();

      async function init() {
        initSidebar();
        initTheme();
        initNavigation();
        initEventModal();
        await loadEvents();
        renderCalendar();
      }

      // Load Events
      async function loadEvents() {
        try {
          const response = await api.get('/api/calendar/');
          events = response.data?.events || getMockEvents();
        } catch (error) {
          console.log('Using mock events');
          events = getMockEvents();
        }
        renderCalendar();
        renderEvents();
        renderDeadlines();
      }

      function getMockEvents() {
        const today = new Date();
        return [
          { id: 1, title: 'File Response', date: formatDate(today), time: '09:00', type: 'deadline', description: 'Response to eviction notice due' },
          { id: 2, title: 'Court Hearing', date: formatDate(addDays(today, 5)), time: '14:00', type: 'hearing', description: 'Initial hearing at County Court' },
          { id: 3, title: 'Legal Aid Meeting', date: formatDate(addDays(today, 2)), time: '10:30', type: 'meeting', description: 'Meeting with legal aid attorney' },
          { id: 4, title: 'Document Review', date: formatDate(addDays(today, 7)), time: '11:00', type: 'reminder', description: 'Review submitted documents' },
        ];
      }

      // Calendar Navigation
      function initNavigation() {
        document.getElementById('prev-month').addEventListener('click', () => {
          currentDate.setMonth(currentDate.getMonth() - 1);
          renderCalendar();
        });

        document.getElementById('next-month').addEventListener('click', () => {
          currentDate.setMonth(currentDate.getMonth() + 1);
          renderCalendar();
        });

        document.getElementById('today-btn').addEventListener('click', () => {
          currentDate = new Date();
          selectedDate = new Date();
          renderCalendar();
          renderEvents();
        });
      }

      // Render Calendar
      function renderCalendar() {
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                           'July', 'August', 'September', 'October', 'November', 'December'];
        document.getElementById('current-month').textContent = 
          `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;

        const grid = document.getElementById('calendar-grid');
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const daysInPrevMonth = new Date(year, month, 0).getDate();
        const today = new Date();

        let html = '';

        // Previous month days
        for (let i = firstDay - 1; i >= 0; i--) {
          const day = daysInPrevMonth - i;
          const date = new Date(year, month - 1, day);
          html += renderDay(day, date, true);
        }

        // Current month days
        for (let day = 1; day <= daysInMonth; day++) {
          const date = new Date(year, month, day);
          const isToday = isSameDay(date, today);
          const isSelected = isSameDay(date, selectedDate);
          html += renderDay(day, date, false, isToday, isSelected);
        }

        // Next month days
        const totalCells = 42;
        const remaining = totalCells - (firstDay + daysInMonth);
        for (let day = 1; day <= remaining; day++) {
          const date = new Date(year, month + 1, day);
          html += renderDay(day, date, true);
        }

        grid.innerHTML = html;

        // Add click handlers
        grid.querySelectorAll('.calendar-day').forEach(cell => {
          cell.addEventListener('click', (e) => {
            if (e.target.classList.contains('calendar-event')) return;
            const dateStr = cell.dataset.date;
            selectedDate = new Date(dateStr + 'T00:00:00');
            renderCalendar();
            renderEvents();
          });
        });
      }

      function renderDay(day, date, otherMonth, isToday = false, isSelected = false) {
        const dateStr = formatDate(date);
        const dayEvents = events.filter(e => e.date === dateStr);
        const classes = ['calendar-day'];
        if (otherMonth) classes.push('other-month');
        if (isToday) classes.push('today');
        if (isSelected) classes.push('selected');

        let eventsHtml = '';
        const maxVisible = 3;
        dayEvents.slice(0, maxVisible).forEach(event => {
          eventsHtml += `<div class="calendar-event ${event.type}" onclick="openEvent(${event.id})" title="${event.title}">${event.title}</div>`;
        });
        if (dayEvents.length > maxVisible) {
          eventsHtml += `<div class="calendar-event-more">+${dayEvents.length - maxVisible} more</div>`;
        }

        return `
          <div class="${classes.join(' ')}" data-date="${dateStr}">
            <div class="calendar-day-number">${day}</div>
            <div class="calendar-events">${eventsHtml}</div>
          </div>
        `;
      }

      // Render Events
      function renderEvents() {
        const container = document.getElementById('events-list');
        const dateStr = formatDate(selectedDate);
        const dayEvents = events.filter(e => e.date === dateStr);

        document.getElementById('selected-date-title').textContent = 
          isSameDay(selectedDate, new Date()) ? "Today's Events" : formatDisplayDate(selectedDate);

        if (dayEvents.length === 0) {
          container.innerHTML = `
            <div class="empty-events">
              <i class="fas fa-calendar-check"></i>
              <p>No events scheduled</p>
            </div>
          `;
          return;
        }

        container.innerHTML = dayEvents.sort((a, b) => (a.time || '').localeCompare(b.time || '')).map(event => `
          <div class="event-item" onclick="openEvent(${event.id})">
            <div class="event-time">${event.time || 'All day'}</div>
            <div class="event-dot ${event.type}"></div>
            <div class="event-content">
              <div class="event-title">${event.title}</div>
              ${event.description ? `<div class="event-desc">${event.description}</div>` : ''}
            </div>
            <div class="event-actions">
              <button class="btn btn-ghost btn-icon btn-sm" onclick="event.stopPropagation(); editEvent(${event.id})">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-ghost btn-icon btn-sm text-danger" onclick="event.stopPropagation(); deleteEvent(${event.id})">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        `).join('');
      }

      // Render Deadlines
      function renderDeadlines() {
        const container = document.getElementById('deadlines-list');
        const today = new Date();
        const upcoming = events
          .filter(e => e.type === 'deadline' && new Date(e.date + 'T00:00:00') >= today)
          .sort((a, b) => a.date.localeCompare(b.date))
          .slice(0, 5);

        if (upcoming.length === 0) {
          container.innerHTML = `
            <div class="empty-events">
              <i class="fas fa-check-circle"></i>
              <p>No upcoming deadlines</p>
            </div>
          `;
          return;
        }

        container.innerHTML = upcoming.map(deadline => {
          const days = Math.ceil((new Date(deadline.date + 'T00:00:00') - today) / (1000 * 60 * 60 * 24));
          const urgent = days <= 3;
          return `
            <div class="deadline-item" onclick="openEvent(${deadline.id})">
              <div class="deadline-icon">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
              <div class="deadline-content">
                <div class="deadline-title">${deadline.title}</div>
                <div class="deadline-date">${formatDisplayDate(new Date(deadline.date + 'T00:00:00'))}</div>
              </div>
              <div class="deadline-badge">${days === 0 ? 'Today' : days === 1 ? '1 day' : `${days} days`}</div>
            </div>
          `;
        }).join('');
      }

      // Event Modal
      function initEventModal() {
        document.getElementById('add-event-btn').addEventListener('click', () => {
          editingEvent = null;
          document.getElementById('modal-title').textContent = 'Add Event';
          document.getElementById('event-form').reset();
          document.getElementById('event-date').value = formatDate(selectedDate);
          document.getElementById('event-modal').classList.add('active');
        });

        document.getElementById('save-event-btn').addEventListener('click', saveEvent);
      }

      window.openEvent = function(id) {
        editEvent(id);
      };

      window.editEvent = function(id) {
        const event = events.find(e => e.id === id);
        if (!event) return;

        editingEvent = event;
        document.getElementById('modal-title').textContent = 'Edit Event';
        document.getElementById('event-id').value = event.id;
        document.getElementById('event-title').value = event.title;
        document.getElementById('event-date').value = event.date;
        document.getElementById('event-time').value = event.time || '';
        document.getElementById('event-type').value = event.type;
        document.getElementById('event-description').value = event.description || '';
        document.getElementById('event-reminder').checked = event.reminder || false;
        document.getElementById('event-modal').classList.add('active');
      };

      async function saveEvent() {
        const form = document.getElementById('event-form');
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        const eventData = {
          id: editingEvent?.id || Date.now(),
          title: document.getElementById('event-title').value,
          date: document.getElementById('event-date').value,
          time: document.getElementById('event-time').value,
          type: document.getElementById('event-type').value,
          description: document.getElementById('event-description').value,
          reminder: document.getElementById('event-reminder').checked
        };

        try {
          if (editingEvent) {
            const idx = events.findIndex(e => e.id === editingEvent.id);
            if (idx >= 0) events[idx] = eventData;
            toast.success('Event updated');
          } else {
            events.push(eventData);
            toast.success('Event added');
          }
          
          closeEventModal();
          renderCalendar();
          renderEvents();
          renderDeadlines();
        } catch (error) {
          toast.error('Failed to save event');
        }
      }

      window.closeEventModal = function() {
        document.getElementById('event-modal').classList.remove('active');
        editingEvent = null;
      };

      window.deleteEvent = async function(id) {
        const confirmed = await modal.confirm({
          title: 'Delete Event',
          message: 'Are you sure you want to delete this event?',
          confirmText: 'Delete',
          confirmVariant: 'danger'
        });

        if (confirmed) {
          events = events.filter(e => e.id !== id);
          toast.success('Event deleted');
          renderCalendar();
          renderEvents();
          renderDeadlines();
        }
      };

      // Utility Functions
      function formatDate(date) {
        return date.toISOString().split('T')[0];
      }

      function formatDisplayDate(date) {
        return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
      }

      function addDays(date, days) {
        const result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
      }

      function isSameDay(d1, d2) {
        return d1.getFullYear() === d2.getFullYear() &&
               d1.getMonth() === d2.getMonth() &&
               d1.getDate() === d2.getDate();
      }

      // Sidebar
      function initSidebar() {
        const sidebar = document.getElementById('sidebar');
        const toggle = document.getElementById('sidebar-toggle');
        const mobile = document.getElementById('mobile-menu-toggle');

        toggle?.addEventListener('click', () => {
          sidebar.classList.toggle('collapsed');
          localStorage.setItem('sidebar_collapsed', sidebar.classList.contains('collapsed'));
        });

        mobile?.addEventListener('click', () => sidebar.classList.toggle('open'));

        if (localStorage.getItem('sidebar_collapsed') === 'true') {
          sidebar.classList.add('collapsed');
        }
      }

      // Theme
      function initTheme() {
        const toggle = document.getElementById('theme-toggle');
        const icon = document.getElementById('theme-icon');

        const update = () => {
          const dark = document.documentElement.getAttribute('data-theme') === 'dark';
          icon.className = dark ? 'fas fa-sun' : 'fas fa-moon';
        };

        toggle?.addEventListener('click', () => {
          const dark = document.documentElement.getAttribute('data-theme') === 'dark';
          const theme = dark ? 'light' : 'dark';
          document.documentElement.setAttribute('data-theme', theme);
          localStorage.setItem('semptify_theme', theme);
          update();
        });

        update();
      }
    })();
  </script>
  <script src="/static/js/help-system.js"></script>
</body>
</html>
