<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Trails - Semptify</title>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a2e;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent-primary: #4f46e5;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --border-color: #2d2d3d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            padding: 2rem 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #ef4444, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Trail Navigation */
        .trail-nav {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .trail-btn {
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .trail-btn:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .trail-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .stat-card.danger .stat-number { color: var(--accent-danger); }
        .stat-card.warning .stat-number { color: var(--accent-warning); }
        .stat-card.success .stat-number { color: var(--accent-success); }
        .stat-card.primary .stat-number { color: var(--accent-primary); }

        /* Trail Sections */
        .trail-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .trail-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Forms */
        .form-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .form-card h2 {
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #4338ca;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--accent-danger);
            color: white;
        }

        .btn-warning {
            background: var(--accent-warning);
            color: black;
        }

        .btn-success {
            background: var(--accent-success);
            color: white;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            color: var(--text-primary);
            font-weight: 600;
            background: var(--bg-tertiary);
        }

        .data-table td {
            color: var(--text-secondary);
        }

        .data-table tr:hover {
            background: var(--bg-tertiary);
        }

        /* Badges */
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-danger { background: rgba(239, 68, 68, 0.2); color: var(--accent-danger); }
        .badge-warning { background: rgba(245, 158, 11, 0.2); color: var(--accent-warning); }
        .badge-success { background: rgba(16, 185, 129, 0.2); color: var(--accent-success); }
        .badge-primary { background: rgba(79, 70, 229, 0.2); color: var(--accent-primary); }

        /* Info Boxes */
        .info-box {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-primary);
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .info-box.danger {
            border-color: var(--accent-danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .info-box.warning {
            border-color: var(--accent-warning);
            background: rgba(245, 158, 11, 0.1);
        }

        .info-box h4 {
            margin-bottom: 0.5rem;
        }

        /* Statute Cards */
        .statute-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .statute-card {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 1.25rem;
            border: 1px solid var(--border-color);
        }

        .statute-card h4 {
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
        }

        .statute-card p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 0.75rem;
        }

        .statute-card a {
            color: var(--accent-primary);
            text-decoration: none;
            font-size: 0.875rem;
        }

        /* Attorney Cards */
        .attorney-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .attorney-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .attorney-card h4 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .attorney-card .specialty {
            color: var(--accent-success);
            font-size: 0.875rem;
            margin-bottom: 0.75rem;
        }

        .attorney-card .note {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-style: italic;
            margin-bottom: 0.75rem;
        }

        .attorney-card .contact {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .attorney-card .contact a {
            color: var(--accent-primary);
            text-decoration: none;
            font-size: 0.875rem;
        }

        /* Timeline */
        .deadline-timeline {
            margin-top: 1rem;
        }

        .deadline-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .deadline-item.critical {
            border-left: 4px solid var(--accent-danger);
        }

        .deadline-item.warning {
            border-left: 4px solid var(--accent-warning);
        }

        .deadline-item.safe {
            border-left: 4px solid var(--accent-success);
        }

        .deadline-days {
            font-size: 1.5rem;
            font-weight: bold;
            min-width: 80px;
            text-align: center;
        }

        .deadline-info h4 {
            margin-bottom: 0.25rem;
        }

        .deadline-info p {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Back Button */
        .back-btn {
            position: fixed;
            top: 1rem;
            left: 1rem;
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 100;
        }

        .back-btn:hover {
            background: var(--bg-tertiary);
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h3 {
            margin-bottom: 1rem;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 1.75rem;
            }

            .trail-nav {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Site-wide header -->
    <script src="/static/js/header.js"></script>

    <a href="/static/command_center.html" class="back-btn">‚Üê Command Center</a>

    <div class="container">
        <header>
            <h1>‚öñÔ∏è Legal Trails</h1>
            <p class="subtitle">Track violations, build your case, and hold them accountable</p>
        </header>

        <!-- Trail Navigation -->
        <div class="trail-nav">
            <button class="trail-btn active" onclick="showTrail('overview')">
                üìä Overview
            </button>
            <button class="trail-btn" onclick="showTrail('violations')">
                üö® Violations
            </button>
            <button class="trail-btn" onclick="showTrail('eviction-threats')">
                ‚ö†Ô∏è Eviction Threats
            </button>
            <button class="trail-btn" onclick="showTrail('late-fees')">
                üí∞ Late Fee Abuse
            </button>
            <button class="trail-btn" onclick="showTrail('broker')">
                üëî Broker Oversight
            </button>
            <button class="trail-btn" onclick="showTrail('claims')">
                üìã Legal Claims
            </button>
            <button class="trail-btn" onclick="showTrail('deadlines')">
                ‚è∞ Filing Deadlines
            </button>
            <button class="trail-btn" onclick="showTrail('attorneys')">
                üë®‚Äç‚öñÔ∏è Find Attorney
            </button>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card danger">
                <div class="stat-number" id="violationsCount">0</div>
                <div class="stat-label">Violations Logged</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-number" id="threatsCount">0</div>
                <div class="stat-label">Eviction Threats</div>
            </div>
            <div class="stat-card primary">
                <div class="stat-number" id="lateFeesCount">0</div>
                <div class="stat-label">Late Fee Violations</div>
            </div>
            <div class="stat-card success">
                <div class="stat-number" id="claimsCount">0</div>
                <div class="stat-label">Legal Claims</div>
            </div>
        </div>

        <!-- Overview Section -->
        <div class="trail-section active" id="trail-overview">
            <div class="form-card">
                <h2>üìú Minnesota Tenant Protection Statutes</h2>
                <div class="statute-grid">
                    <div class="statute-card">
                        <h4>MN 504B.177 - Late Fees</h4>
                        <p>Late fees must be in lease and cannot exceed 8% of overdue rent</p>
                        <a href="https://www.revisor.mn.gov/statutes/cite/504B.177" target="_blank">View Statute ‚Üí</a>
                    </div>
                    <div class="statute-card">
                        <h4>MN 504B.285 - Retaliatory Eviction</h4>
                        <p>Landlords cannot evict tenants for asserting legal rights</p>
                        <a href="https://www.revisor.mn.gov/statutes/cite/504B.285" target="_blank">View Statute ‚Üí</a>
                    </div>
                    <div class="statute-card">
                        <h4>MN 504B.161 - Tenant Remedies</h4>
                        <p>Tenant rights to repair and deduct, rent escrow</p>
                        <a href="https://www.revisor.mn.gov/statutes/cite/504B.161" target="_blank">View Statute ‚Üí</a>
                    </div>
                    <div class="statute-card">
                        <h4>MN 504B.211 - Security Deposits</h4>
                        <p>Rules for security deposit handling and return</p>
                        <a href="https://www.revisor.mn.gov/statutes/cite/504B.211" target="_blank">View Statute ‚Üí</a>
                    </div>
                </div>
            </div>

            <div class="form-card">
                <h2>‚è∞ Statute of Limitations</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Claim Type</th>
                            <th>Time Limit</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Civil Retaliation</td>
                            <td><span class="badge badge-warning">6 Years</span></td>
                            <td>From date of retaliatory act</td>
                        </tr>
                        <tr>
                            <td>Civil Fraud</td>
                            <td><span class="badge badge-warning">6 Years</span></td>
                            <td>May toll if fraud was concealed</td>
                        </tr>
                        <tr>
                            <td>HUD Complaint</td>
                            <td><span class="badge badge-danger">1 Year</span></td>
                            <td>Fair housing discrimination claims</td>
                        </tr>
                        <tr>
                            <td>Criminal Theft</td>
                            <td><span class="badge badge-warning">5 Years</span></td>
                            <td>Government benefit theft: 6 years</td>
                        </tr>
                        <tr>
                            <td>License Complaint</td>
                            <td><span class="badge badge-primary">2 Years</span></td>
                            <td>MN Dept of Commerce</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Violations Section -->
        <div class="trail-section" id="trail-violations">
            <div class="form-card">
                <h2>üö® Log a Violation</h2>
                <form id="violationForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Violation Type *</label>
                            <select name="violation_type" required>
                                <option value="">Select type...</option>
                                <option value="false_late_fee">False Late Fee</option>
                                <option value="eviction_threat">Eviction Threat</option>
                                <option value="retaliation">Retaliation</option>
                                <option value="coercion">Coercion</option>
                                <option value="fraud">Fraud</option>
                                <option value="lease_breach">Lease Breach</option>
                                <option value="habitability">Habitability Issue</option>
                                <option value="harassment">Harassment</option>
                                <option value="discrimination">Discrimination</option>
                                <option value="misuse_federal_funds">Misuse of Federal Funds</option>
                                <option value="license_violation">License Violation</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date Occurred *</label>
                            <input type="date" name="date_occurred" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description *</label>
                        <textarea name="description" placeholder="Describe what happened in detail..." required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Perpetrator Name *</label>
                            <input type="text" name="perpetrator" placeholder="e.g., Jane Smith" required>
                        </div>
                        <div class="form-group">
                            <label>Perpetrator Role *</label>
                            <input type="text" name="perpetrator_role" placeholder="e.g., Property Manager" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Company *</label>
                            <input type="text" name="company" placeholder="e.g., Velair Property Management" required>
                        </div>
                        <div class="form-group">
                            <label>Amount (if financial)</label>
                            <input type="number" name="amount_if_financial" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-danger">üö® Log Violation</button>
                </form>
            </div>

            <div class="form-card">
                <h2>üìã Logged Violations</h2>
                <div id="violationsList">
                    <p style="color: var(--text-secondary);">No violations logged yet.</p>
                </div>
            </div>
        </div>

        <!-- Eviction Threats Section -->
        <div class="trail-section" id="trail-eviction-threats">
            <div class="info-box danger">
                <h4>‚ö†Ô∏è Retaliatory Eviction is Illegal</h4>
                <p>Under MN 504B.285, landlords cannot evict tenants for asserting legal rights, complaining about conditions, or reporting violations.</p>
            </div>

            <div class="form-card">
                <h2>‚ö†Ô∏è Log an Eviction Threat</h2>
                <form id="threatForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Date of Threat *</label>
                            <input type="date" name="date_threatened" required>
                        </div>
                        <div class="form-group">
                            <label>Threat Method *</label>
                            <select name="threat_method" required>
                                <option value="">Select...</option>
                                <option value="verbal">Verbal</option>
                                <option value="written">Written/Text</option>
                                <option value="notice">Formal Notice</option>
                                <option value="email">Email</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>What Did They Say/Write? *</label>
                        <textarea name="threat_content" placeholder="Quote or describe the threat as exactly as possible..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Context (What was happening when threat was made?) *</label>
                        <textarea name="context" placeholder="e.g., After I complained about false late fees..." required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Prior Complaint Date (if retaliatory)</label>
                            <input type="date" name="prior_complaint_date">
                        </div>
                        <div class="form-group">
                            <label>Prior Complaint Type</label>
                            <input type="text" name="prior_complaint_type" placeholder="e.g., Disputed late fees">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Perpetrator Name *</label>
                            <input type="text" name="perpetrator" required>
                        </div>
                        <div class="form-group">
                            <label>Perpetrator Role *</label>
                            <input type="text" name="perpetrator_role" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-warning">‚ö†Ô∏è Log Eviction Threat</button>
                </form>
            </div>

            <div class="form-card">
                <h2>üìã Logged Threats</h2>
                <div id="threatsList">
                    <p style="color: var(--text-secondary);">No threats logged yet.</p>
                </div>
            </div>
        </div>

        <!-- Late Fees Section -->
        <div class="trail-section" id="trail-late-fees">
            <div class="info-box">
                <h4>üìú MN 504B.177 - Late Fee Rules</h4>
                <p>‚Ä¢ Late fees MUST be specified in the lease<br>
                   ‚Ä¢ Cannot exceed 8% of overdue rent<br>
                   ‚Ä¢ No "early discount" tricks to create fake late fees</p>
            </div>

            <div class="form-card">
                <h2>üí∞ Log a Late Fee Violation</h2>
                <form id="lateFeeForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Date Charged *</label>
                            <input type="date" name="date_charged" required>
                        </div>
                        <div class="form-group">
                            <label>Days Late *</label>
                            <input type="number" name="days_late" min="0" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Rent Amount *</label>
                            <input type="number" name="rent_amount" step="0.01" required placeholder="e.g., 1200.00">
                        </div>
                        <div class="form-group">
                            <label>Late Fee Charged *</label>
                            <input type="number" name="amount_charged" step="0.01" required placeholder="e.g., 150.00">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Is Late Fee in Your Lease?</label>
                            <select name="lease_allows_late_fee">
                                <option value="true">Yes</option>
                                <option value="false">No</option>
                                <option value="false">Not Sure</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Lease Late Fee Amount (if any)</label>
                            <input type="number" name="lease_late_fee_amount" step="0.01" placeholder="Amount in lease">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">üí∞ Calculate & Log</button>
                </form>

                <div id="lateFeeResult" style="display: none; margin-top: 1.5rem;">
                    <div class="info-box warning">
                        <h4>üßÆ Late Fee Analysis</h4>
                        <div id="lateFeeAnalysis"></div>
                    </div>
                </div>
            </div>

            <div class="form-card">
                <h2>üìä Late Fee Calculator</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Monthly Rent</label>
                        <input type="number" id="calcRent" step="0.01" placeholder="1200.00">
                    </div>
                    <div class="form-group">
                        <label>Legal Maximum (8%)</label>
                        <input type="text" id="calcMax" readonly style="background: var(--bg-primary);">
                    </div>
                </div>
                <button type="button" class="btn btn-primary" onclick="calculateMax()">Calculate</button>
            </div>

            <div class="form-card">
                <h2>üìã Logged Late Fee Violations</h2>
                <div id="lateFeesList">
                    <p style="color: var(--text-secondary);">No late fee violations logged yet.</p>
                </div>
            </div>
        </div>

        <!-- Broker Oversight Section -->
        <div class="trail-section" id="trail-broker">
            <div class="info-box">
                <h4>üëî Broker Accountability</h4>
                <p>As the broker of record, the broker holds legal responsibility for ensuring compliance with Minnesota housing laws and ethical conduct of property managers.</p>
            </div>

            <div class="form-card">
                <h2>üëî Track Broker Oversight</h2>
                <form id="brokerForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Broker Name *</label>
                            <input type="text" name="broker_name" required placeholder="e.g., Ryan Schwickert">
                        </div>
                        <div class="form-group">
                            <label>License Number (if known)</label>
                            <input type="text" name="broker_license" placeholder="License #">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Company *</label>
                            <input type="text" name="broker_company" required placeholder="e.g., MWF Properties">
                        </div>
                        <div class="form-group">
                            <label>Company Address *</label>
                            <input type="text" name="company_address" required placeholder="Full address">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Properties Managed (comma separated)</label>
                        <input type="text" name="managed_properties" placeholder="e.g., Lexington Flats, Other Property">
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea name="notes" placeholder="Any relevant information about broker oversight failures..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">üëî Add Broker Record</button>
                </form>
            </div>

            <div class="form-card">
                <h2>üîç License Lookup</h2>
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    Verify broker licenses through the Minnesota Department of Commerce:
                </p>
                <a href="https://mn.gov/commerce/consumers/your-license/" target="_blank" class="btn btn-primary">
                    üîé MN License Lookup
                </a>
            </div>

            <div class="form-card">
                <h2>üìã Tracked Brokers</h2>
                <div id="brokersList">
                    <p style="color: var(--text-secondary);">No brokers tracked yet.</p>
                </div>
            </div>
        </div>

        <!-- Legal Claims Section -->
        <div class="trail-section" id="trail-claims">
            <div class="form-card">
                <h2>üìã Create Legal Claim</h2>
                <form id="claimForm">
                    <div class="form-group">
                        <label>Claim Title *</label>
                        <input type="text" name="title" required placeholder="e.g., Retaliatory Eviction & False Late Fees">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Claim Type *</label>
                            <select name="claim_type" required>
                                <option value="civil">Civil</option>
                                <option value="criminal">Criminal</option>
                                <option value="regulatory">Regulatory</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Filing Destination</label>
                            <select name="filing_destination">
                                <option value="">Select...</option>
                                <option value="MN_ATTORNEY_GENERAL">Minnesota Attorney General</option>
                                <option value="MN_DEPT_COMMERCE">MN Dept of Commerce</option>
                                <option value="HUD_FAIR_HOUSING">HUD Office of Fair Housing</option>
                                <option value="DISTRICT_COURT">District Court</option>
                                <option value="FEDERAL_COURT">Federal Court</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Statute of Limitations Date *</label>
                            <input type="date" name="statute_of_limitations_date" required>
                        </div>
                        <div class="form-group">
                            <label>Filing Deadline *</label>
                            <input type="date" name="filing_deadline" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Defendants (comma separated)</label>
                        <input type="text" name="defendants" placeholder="e.g., Velair Property Management, Ryan Schwickert">
                    </div>
                    <div class="form-group">
                        <label>Damages Sought</label>
                        <input type="number" name="damages_sought" step="0.01" placeholder="Total damages amount">
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea name="notes" placeholder="Additional claim details..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">üìã Create Claim</button>
                </form>
            </div>

            <div class="form-card">
                <h2>üìÅ Active Claims</h2>
                <div id="claimsList">
                    <p style="color: var(--text-secondary);">No claims created yet.</p>
                </div>
            </div>
        </div>

        <!-- Filing Deadlines Section -->
        <div class="trail-section" id="trail-deadlines">
            <div class="form-card">
                <h2>‚è∞ Calculate Filing Deadlines</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Violation Date *</label>
                        <input type="date" id="deadlineViolationDate">
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button type="button" class="btn btn-primary" onclick="calculateDeadlines()">
                            ‚è∞ Calculate All Deadlines
                        </button>
                    </div>
                </div>
            </div>

            <div class="form-card">
                <h2>üìÖ Filing Windows</h2>
                <div class="deadline-timeline" id="deadlineTimeline">
                    <p style="color: var(--text-secondary);">Enter a violation date to see all filing deadlines.</p>
                </div>
            </div>
        </div>

        <!-- Attorneys Section -->
        <div class="trail-section" id="trail-attorneys">
            <div class="info-box">
                <h4>üë®‚Äç‚öñÔ∏è Finding the Right Attorney</h4>
                <p>You need an attorney who specializes in tenant rights and isn't afraid to go after landlords who abuse the system. These firms have track records of fighting for tenants.</p>
            </div>

            <div class="form-card">
                <h2>üî• Top Minnesota Tenant Rights Attorneys</h2>
                <div class="attorney-grid" id="attorneyList">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="form-card">
                <h2>üÜì Free Legal Resources</h2>
                <div class="attorney-grid">
                    <div class="attorney-card">
                        <h4>HOME Line</h4>
                        <div class="specialty">Free tenant hotline and legal help</div>
                        <div class="contact">
                            <a href="tel:612-728-5767">üìû 612-728-5767</a>
                            <a href="https://homelinemn.org" target="_blank">üåê Website</a>
                        </div>
                    </div>
                    <div class="attorney-card">
                        <h4>Legal Aid - Housing</h4>
                        <div class="specialty">Free legal services for low-income tenants</div>
                        <div class="contact">
                            <a href="tel:612-334-5970">üìû 612-334-5970</a>
                            <a href="https://mylegalaid.org" target="_blank">üåê Website</a>
                        </div>
                    </div>
                    <div class="attorney-card">
                        <h4>Volunteer Lawyers Network</h4>
                        <div class="specialty">Pro bono legal assistance</div>
                        <div class="contact">
                            <a href="https://vlnmn.org" target="_blank">üåê Website</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-card">
                <h2>üîó Attorney Directories</h2>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <a href="https://www.superlawyers.com/minnesota/" target="_blank" class="btn btn-primary">Super Lawyers MN</a>
                    <a href="https://www.findlaw.com/minnesota/" target="_blank" class="btn btn-primary">FindLaw MN</a>
                    <a href="https://www.avvo.com/landlord-tenant-lawyer/mn.html" target="_blank" class="btn btn-primary">Avvo</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State
        let currentTrail = 'overview';

        // Show Trail
        function showTrail(trail) {
            // Update buttons
            document.querySelectorAll('.trail-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update sections
            document.querySelectorAll('.trail-section').forEach(sec => sec.classList.remove('active'));
            document.getElementById(`trail-${trail}`).classList.add('active');

            currentTrail = trail;

            // Load data for the trail
            if (trail === 'violations') loadViolations();
            if (trail === 'eviction-threats') loadThreats();
            if (trail === 'late-fees') loadLateFees();
            if (trail === 'broker') loadBrokers();
            if (trail === 'claims') loadClaims();
            if (trail === 'attorneys') loadAttorneys();
        }

        // Load Overview Stats
        async function loadStats() {
            try {
                const response = await fetch('/legal-trails/');
                const data = await response.json();
                document.getElementById('violationsCount').textContent = data.violations_count;
                document.getElementById('threatsCount').textContent = data.eviction_threats_count;
                document.getElementById('lateFeesCount').textContent = data.late_fee_violations_count;
                document.getElementById('claimsCount').textContent = data.legal_claims_count;
            } catch (err) {
                console.error('Error loading stats:', err);
            }
        }

        // Violations
        document.getElementById('violationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                violation_type: formData.get('violation_type'),
                date_occurred: formData.get('date_occurred'),
                description: formData.get('description'),
                perpetrator: formData.get('perpetrator'),
                perpetrator_role: formData.get('perpetrator_role'),
                company: formData.get('company'),
                amount_if_financial: parseFloat(formData.get('amount_if_financial')) || null
            };

            try {
                const response = await fetch('/legal-trails/violations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert('Violation logged: ' + result.violation_id);
                e.target.reset();
                loadViolations();
                loadStats();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        });

        async function loadViolations() {
            try {
                const response = await fetch('/legal-trails/violations');
                const data = await response.json();
                const list = document.getElementById('violationsList');
                
                if (data.violations.length === 0) {
                    list.innerHTML = '<p style="color: var(--text-secondary);">No violations logged yet.</p>';
                    return;
                }

                list.innerHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Perpetrator</th>
                                <th>Company</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.violations.map(v => `
                                <tr>
                                    <td>${v.id}</td>
                                    <td><span class="badge badge-danger">${v.violation_type}</span></td>
                                    <td>${v.date_occurred}</td>
                                    <td>${v.perpetrator} (${v.perpetrator_role})</td>
                                    <td>${v.company}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (err) {
                console.error('Error loading violations:', err);
            }
        }

        // Eviction Threats
        document.getElementById('threatForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                date_threatened: formData.get('date_threatened'),
                threat_method: formData.get('threat_method'),
                threat_content: formData.get('threat_content'),
                context: formData.get('context'),
                prior_complaint_date: formData.get('prior_complaint_date') || null,
                prior_complaint_type: formData.get('prior_complaint_type') || null,
                perpetrator: formData.get('perpetrator'),
                perpetrator_role: formData.get('perpetrator_role'),
                was_retaliatory: true
            };

            try {
                const response = await fetch('/legal-trails/eviction-threats', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert('Threat logged: ' + result.threat_id + '\n\n' + result.warning);
                e.target.reset();
                loadThreats();
                loadStats();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        });

        async function loadThreats() {
            try {
                const response = await fetch('/legal-trails/eviction-threats');
                const data = await response.json();
                const list = document.getElementById('threatsList');
                
                if (data.threats.length === 0) {
                    list.innerHTML = '<p style="color: var(--text-secondary);">No threats logged yet.</p>';
                    return;
                }

                list.innerHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Date</th>
                                <th>Method</th>
                                <th>Perpetrator</th>
                                <th>Context</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.threats.map(t => `
                                <tr>
                                    <td>${t.id}</td>
                                    <td>${t.date_threatened}</td>
                                    <td><span class="badge badge-warning">${t.threat_method}</span></td>
                                    <td>${t.perpetrator}</td>
                                    <td>${t.context.substring(0, 50)}...</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (err) {
                console.error('Error loading threats:', err);
            }
        }

        // Late Fees
        document.getElementById('lateFeeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                date_charged: formData.get('date_charged'),
                amount_charged: parseFloat(formData.get('amount_charged')),
                rent_amount: parseFloat(formData.get('rent_amount')),
                days_late: parseInt(formData.get('days_late')),
                lease_allows_late_fee: formData.get('lease_allows_late_fee') === 'true',
                lease_late_fee_amount: parseFloat(formData.get('lease_late_fee_amount')) || null
            };

            try {
                const response = await fetch('/legal-trails/late-fees', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                
                // Show analysis
                document.getElementById('lateFeeResult').style.display = 'block';
                document.getElementById('lateFeeAnalysis').innerHTML = `
                    <p><strong>Fee Charged:</strong> $${data.amount_charged.toFixed(2)}</p>
                    <p><strong>Legal Max (8%):</strong> $${result.legal_max_fee.toFixed(2)}</p>
                    <p><strong>Exceeds Limit:</strong> ${result.exceeds_8_percent ? '‚ö†Ô∏è YES' : '‚úÖ No'}</p>
                    ${result.overcharge_amount > 0 ? `<p><strong>Overcharged By:</strong> $${result.overcharge_amount.toFixed(2)}</p>` : ''}
                    ${result.violations_detected.length > 0 ? `<p><strong>Violations:</strong><br>${result.violations_detected.join('<br>')}</p>` : ''}
                `;
                
                loadLateFees();
                loadStats();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        });

        async function loadLateFees() {
            try {
                const response = await fetch('/legal-trails/late-fees');
                const data = await response.json();
                const list = document.getElementById('lateFeesList');
                
                if (data.violations.length === 0) {
                    list.innerHTML = '<p style="color: var(--text-secondary);">No late fee violations logged yet.</p>';
                    return;
                }

                list.innerHTML = `
                    <div class="info-box warning">
                        <h4>üí∞ Total Overcharged: $${data.total_overcharged.toFixed(2)}</h4>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Rent</th>
                                <th>Fee Charged</th>
                                <th>Legal Max</th>
                                <th>Overcharge</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.violations.map(f => `
                                <tr>
                                    <td>${f.date_charged}</td>
                                    <td>$${f.rent_amount.toFixed(2)}</td>
                                    <td>$${f.amount_charged.toFixed(2)}</td>
                                    <td>$${f.legal_max_fee.toFixed(2)}</td>
                                    <td>${f.overcharge_amount > 0 ? `<span class="badge badge-danger">$${f.overcharge_amount.toFixed(2)}</span>` : '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (err) {
                console.error('Error loading late fees:', err);
            }
        }

        function calculateMax() {
            const rent = parseFloat(document.getElementById('calcRent').value);
            if (rent) {
                const max = (rent * 0.08).toFixed(2);
                document.getElementById('calcMax').value = '$' + max;
            }
        }

        // Brokers
        document.getElementById('brokerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                broker_name: formData.get('broker_name'),
                broker_license: formData.get('broker_license') || null,
                broker_company: formData.get('broker_company'),
                company_address: formData.get('company_address'),
                managed_properties: formData.get('managed_properties') ? formData.get('managed_properties').split(',').map(p => p.trim()) : [],
                notes: formData.get('notes') || ''
            };

            try {
                const response = await fetch('/legal-trails/broker-oversight', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert('Broker record added: ' + data.broker_name);
                e.target.reset();
                loadBrokers();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        });

        async function loadBrokers() {
            try {
                const response = await fetch('/legal-trails/broker-oversight');
                const data = await response.json();
                const list = document.getElementById('brokersList');
                
                if (data.brokers.length === 0) {
                    list.innerHTML = '<p style="color: var(--text-secondary);">No brokers tracked yet.</p>';
                    return;
                }

                list.innerHTML = data.brokers.map(b => `
                    <div class="info-box">
                        <h4>üëî ${b.broker_name}</h4>
                        <p><strong>Company:</strong> ${b.broker_company}</p>
                        <p><strong>Address:</strong> ${b.company_address}</p>
                        <p><strong>License:</strong> ${b.broker_license || 'Unknown'}</p>
                        <p><strong>Properties:</strong> ${b.managed_properties.join(', ') || 'None listed'}</p>
                        ${b.notes ? `<p><strong>Notes:</strong> ${b.notes}</p>` : ''}
                    </div>
                `).join('');
            } catch (err) {
                console.error('Error loading brokers:', err);
            }
        }

        // Claims
        document.getElementById('claimForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                title: formData.get('title'),
                claim_type: formData.get('claim_type'),
                filing_destination: formData.get('filing_destination') || null,
                statute_of_limitations_date: formData.get('statute_of_limitations_date'),
                filing_deadline: formData.get('filing_deadline'),
                defendants: formData.get('defendants') ? formData.get('defendants').split(',').map(d => d.trim()) : [],
                damages_sought: parseFloat(formData.get('damages_sought')) || null,
                notes: formData.get('notes') || ''
            };

            try {
                const response = await fetch('/legal-trails/claims', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert('Claim created: ' + result.claim_id);
                e.target.reset();
                loadClaims();
                loadStats();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        });

        async function loadClaims() {
            try {
                const response = await fetch('/legal-trails/claims');
                const data = await response.json();
                const list = document.getElementById('claimsList');
                
                if (data.claims.length === 0) {
                    list.innerHTML = '<p style="color: var(--text-secondary);">No claims created yet.</p>';
                    return;
                }

                list.innerHTML = data.claims.map(c => `
                    <div class="info-box">
                        <h4>üìã ${c.title}</h4>
                        <p><strong>Type:</strong> ${c.claim_type} | <strong>Status:</strong> <span class="badge badge-primary">${c.status}</span></p>
                        <p><strong>Defendants:</strong> ${c.defendants.join(', ')}</p>
                        <p><strong>Filing Deadline:</strong> ${c.filing_deadline}</p>
                        ${c.damages_sought ? `<p><strong>Damages Sought:</strong> $${c.damages_sought.toFixed(2)}</p>` : ''}
                    </div>
                `).join('');
            } catch (err) {
                console.error('Error loading claims:', err);
            }
        }

        // Deadlines
        async function calculateDeadlines() {
            const date = document.getElementById('deadlineViolationDate').value;
            if (!date) {
                alert('Please enter a violation date');
                return;
            }

            try {
                const response = await fetch(`/legal-trails/filing-windows?violation_date=${date}`);
                const data = await response.json();
                const timeline = document.getElementById('deadlineTimeline');

                timeline.innerHTML = data.windows.map(w => `
                    <div class="deadline-item ${w.urgency}">
                        <div class="deadline-days" style="color: var(--accent-${w.urgency === 'critical' ? 'danger' : w.urgency === 'warning' ? 'warning' : 'success'});">
                            ${w.days_remaining}<br><small>days</small>
                        </div>
                        <div class="deadline-info">
                            <h4>${w.claim_type.replace(/_/g, ' ').toUpperCase()}</h4>
                            <p>Deadline: ${w.deadline} (${w.limitation_years} year limit)</p>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                alert('Error calculating deadlines: ' + err.message);
            }
        }

        // Attorneys
        async function loadAttorneys() {
            try {
                const response = await fetch('/legal-trails/attorneys/minnesota');
                const data = await response.json();
                const list = document.getElementById('attorneyList');

                list.innerHTML = data.attorneys.map(a => `
                    <div class="attorney-card">
                        <h4>${a.name}</h4>
                        <div class="specialty">${a.specialty}</div>
                        ${a.note ? `<div class="note">"${a.note}"</div>` : ''}
                        <div class="contact">
                            ${a.phone ? `<a href="tel:${a.phone}">üìû ${a.phone}</a>` : ''}
                            ${a.website ? `<a href="${a.website}" target="_blank">üåê Website</a>` : ''}
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Error loading attorneys:', err);
            }
        }

        // Initialize
        loadStats();
        loadAttorneys();
    </script>
</body>
</html>
