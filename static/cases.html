<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Management - Semptify</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/shared-nav.css">
    <link rel="stylesheet" href="/static/css/help-system.css">
    <!-- Case Context Manager - Central case data service -->
    <script src="/static/js/case-context.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
        }
        
        body {
            background: var(--bg-dark);
            color: var(--text-primary);
            font-family: 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
        }
        
        /* Main Layout */
        .main-content {
            margin-left: 260px;
            padding: 2rem;
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
        }
        
        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .page-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .header-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        .btn-primary-custom {
            background: var(--primary);
            border: none;
            color: white;
            padding: 0.6rem 1.25rem;
            border-radius: 6px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.15s ease;
        }
        
        .btn-primary-custom:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
        }
        
        /* Stats Overview */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.25rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .stat-icon.active { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .stat-icon.pending { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .stat-icon.closed { background: rgba(148, 163, 184, 0.2); color: var(--text-secondary); }
        .stat-icon.urgent { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        
        .stat-info h3 {
            font-size: 1.75rem;
            font-weight: 700;
            margin: 0;
        }
        
        .stat-info p {
            color: var(--text-secondary);
            margin: 0;
            font-size: 0.85rem;
        }
        
        /* Filter/Search Bar */
        .filter-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.6rem 1rem 0.6rem 2.5rem;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .search-box i {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .filter-select {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.6rem 1rem;
            border-radius: 6px;
            min-width: 150px;
        }
        
        /* View Toggle */
        .view-toggle {
            display: flex;
            background: var(--bg-card);
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        
        .view-toggle button {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 0.6rem 1rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .view-toggle button.active {
            background: var(--primary);
            color: white;
        }
        
        /* Cases Grid */
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1rem;
        }
        
        /* Case Card */
        .case-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.25rem;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }
        
        .case-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.2);
        }
        
        .case-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .case-number {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary);
        }
        
        .case-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .case-status.active { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .case-status.draft { background: rgba(148, 163, 184, 0.2); color: var(--text-secondary); }
        .case-status.filed { background: rgba(59, 130, 246, 0.2); color: var(--info); }
        .case-status.closed { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .case-status.urgent { background: rgba(239, 68, 68, 0.3); color: #fca5a5; }
        
        .case-title {
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }
        
        .case-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }
        
        .case-meta-item {
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }
        
        .case-progress {
            margin-bottom: 1rem;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 0.35rem;
        }
        
        .progress-bar-container {
            height: 6px;
            background: var(--bg-dark);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .case-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
        }
        
        .case-deadline {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }
        
        .case-deadline.urgent {
            color: var(--danger);
            font-weight: 600;
        }
        
        .case-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .case-action-btn {
            background: var(--bg-hover);
            border: none;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .case-action-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        /* Cases Table View */
        .cases-table {
            display: none;
            width: 100%;
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        
        .cases-table.active {
            display: block;
        }
        
        .cases-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .cases-table th {
            background: var(--bg-hover);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            border-bottom: 1px solid var(--border-color);
        }
        
        .cases-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        
        .cases-table tr:hover {
            background: var(--bg-hover);
        }
        
        .cases-table tr:last-child td {
            border-bottom: none;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        /* Modals */
        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        
        .modal-header {
            border-bottom: 1px solid var(--border-color);
            padding: 1.25rem 1.5rem;
        }
        
        .modal-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            border-top: 1px solid var(--border-color);
            padding: 1rem 1.5rem;
        }
        
        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .form-control, .form-select {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.6rem 1rem;
            border-radius: 6px;
        }
        
        .form-control:focus, .form-select:focus {
            background: var(--bg-dark);
            border-color: var(--primary);
            color: var(--text-primary);
            box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
        }
        
        .form-text {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }
        
        /* Case Detail Panel (Slide-out) */
        .case-detail-panel {
            position: fixed;
            top: 0;
            right: -500px;
            width: 500px;
            max-width: 100vw;
            height: 100vh;
            background: var(--bg-card);
            border-left: 1px solid var(--border-color);
            z-index: 10000;
            transition: right 0.3s ease;
            overflow-y: auto;
        }
        
        .case-detail-panel.open {
            right: 0;
            box-shadow: -10px 0 40px rgba(0, 0, 0, 0.3);
        }
        
        .panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .panel-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .panel-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 1;
        }
        
        .panel-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .panel-close:hover {
            color: var(--text-primary);
        }
        
        .panel-body {
            padding: 1.5rem;
        }
        
        .panel-section {
            margin-bottom: 1.5rem;
        }
        
        .panel-section-title {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }
        
        /* Tab Navigation in Panel */
        .panel-tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }
        
        .panel-tab {
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            border-bottom: 2px solid transparent;
            transition: all 0.15s ease;
        }
        
        .panel-tab:hover {
            color: var(--text-primary);
        }
        
        .panel-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .panel-tab-content {
            display: none;
        }
        
        .panel-tab-content.active {
            display: block;
        }
        
        /* Timeline in Panel */
        .mini-timeline {
            position: relative;
            padding-left: 1.5rem;
        }
        
        .mini-timeline::before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border-color);
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 1rem;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -1.25rem;
            top: 0.25rem;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary);
            border: 2px solid var(--bg-card);
        }
        
        .timeline-date {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .timeline-title {
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* Defense Items */
        .defense-item {
            background: var(--bg-dark);
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .defense-strength {
            width: 8px;
            height: 40px;
            border-radius: 4px;
        }
        
        .defense-strength.strong { background: var(--success); }
        .defense-strength.medium { background: var(--warning); }
        .defense-strength.weak { background: var(--danger); }
        
        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        
        .quick-action-btn {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            text-align: center;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .quick-action-btn:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }
        
        .quick-action-btn i {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            display: block;
            color: var(--primary);
        }
        
        .quick-action-btn span {
            font-size: 0.8rem;
        }
        
        /* Urgent Alert */
        .urgent-alert {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .urgent-alert i {
            color: var(--danger);
            font-size: 1.5rem;
        }
        
        .urgent-alert-content h4 {
            margin: 0 0 0.25rem 0;
            color: var(--danger);
            font-size: 0.95rem;
        }
        
        .urgent-alert-content p {
            margin: 0;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        /* Loading */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Shared Navigation -->
    <div id="semptify-nav"></div>
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="container-fluid">
            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">
                    <span>ðŸ“‹</span> Case Management
                </h1>
                <div class="header-actions">
                    <button class="btn-primary-custom" onclick="openNewCaseModal()">
                        <i class="bi bi-plus-lg"></i> New Case
                    </button>
                </div>
            </div>
            
            <!-- Stats Overview -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-icon active">
                        <i class="bi bi-folder-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="stat-active">0</h3>
                        <p>Active Cases</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon pending">
                        <i class="bi bi-hourglass-split"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="stat-pending">0</h3>
                        <p>Pending Action</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon urgent">
                        <i class="bi bi-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="stat-urgent">0</h3>
                        <p>Urgent Deadlines</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon closed">
                        <i class="bi bi-archive"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="stat-closed">0</h3>
                        <p>Closed Cases</p>
                    </div>
                </div>
            </div>
            
            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="search-box">
                    <i class="bi bi-search"></i>
                    <input type="text" placeholder="Search cases..." id="search-input" oninput="filterCases()">
                </div>
                <select class="filter-select" id="status-filter" onchange="filterCases()">
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="draft">Draft</option>
                    <option value="filed">Filed</option>
                    <option value="closed">Closed</option>
                </select>
                <select class="filter-select" id="type-filter" onchange="filterCases()">
                    <option value="">All Types</option>
                    <option value="eviction_defense">Eviction Defense</option>
                    <option value="counter_claim">Counter Claim</option>
                    <option value="habitability">Habitability</option>
                    <option value="discrimination">Discrimination</option>
                </select>
                <div class="view-toggle">
                    <button class="active" onclick="setView('grid')" id="view-grid"><i class="bi bi-grid-3x2-gap"></i></button>
                    <button onclick="setView('table')" id="view-table"><i class="bi bi-list"></i></button>
                </div>
            </div>
            
            <!-- Cases Grid View -->
            <div class="cases-grid" id="cases-grid">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
            </div>
            
            <!-- Cases Table View -->
            <div class="cases-table" id="cases-table">
                <table>
                    <thead>
                        <tr>
                            <th>Case #</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Court</th>
                            <th>Next Deadline</th>
                            <th>Progress</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="cases-table-body">
                    </tbody>
                </table>
            </div>
            
            <!-- Empty State -->
            <div class="empty-state" id="empty-state" style="display: none;">
                <i class="bi bi-folder2-open"></i>
                <h3>No Cases Yet</h3>
                <p>Create your first case to start building your defense</p>
                <button class="btn-primary-custom mt-3" onclick="openNewCaseModal()">
                    <i class="bi bi-plus-lg"></i> Create Case
                </button>
            </div>
        </div>
    </main>
    
    <!-- Case Detail Slide-out Panel -->
    <div class="panel-overlay" id="panel-overlay" onclick="closePanel()"></div>
    <div class="case-detail-panel" id="case-panel">
        <div class="panel-header">
            <div>
                <h3 class="mb-0" id="panel-case-number">Case #</h3>
                <small class="text-muted" id="panel-case-type">Eviction Defense</small>
            </div>
            <button class="panel-close" onclick="closePanel()">
                <i class="bi bi-x"></i>
            </button>
        </div>
        
        <div class="panel-body">
            <!-- Urgent Alert (shown conditionally) -->
            <div class="urgent-alert" id="panel-urgent-alert" style="display: none;">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <div class="urgent-alert-content">
                    <h4>Urgent Deadline Approaching</h4>
                    <p id="panel-urgent-message">Hearing in 3 days</p>
                </div>
            </div>
            
            <!-- Panel Tabs -->
            <div class="panel-tabs">
                <button class="panel-tab active" onclick="showPanelTab('overview')">Overview</button>
                <button class="panel-tab" onclick="showPanelTab('timeline')">Timeline</button>
                <button class="panel-tab" onclick="showPanelTab('defenses')">Defenses</button>
                <button class="panel-tab" onclick="showPanelTab('evidence')">Evidence</button>
            </div>
            
            <!-- Overview Tab -->
            <div class="panel-tab-content active" id="tab-overview">
                <div class="panel-section">
                    <div class="panel-section-title">Case Status</div>
                    <div class="d-flex align-items-center gap-2 mb-3">
                        <span class="case-status active" id="panel-status">Active</span>
                        <span class="text-muted">â€¢</span>
                        <span id="panel-progress-text">65% Complete</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="panel-progress-bar" style="width: 65%"></div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <div class="panel-section-title">Key Information</div>
                    <div class="row g-2">
                        <div class="col-6">
                            <small class="text-muted">Court</small>
                            <p class="mb-2" id="panel-court">Dakota County District Court</p>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Hearing Date</small>
                            <p class="mb-2" id="panel-hearing">Jan 15, 2025</p>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Plaintiff</small>
                            <p class="mb-2" id="panel-plaintiff">ABC Property Management</p>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Property</small>
                            <p class="mb-2" id="panel-property">123 Main St</p>
                        </div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <div class="panel-section-title">Quick Actions</div>
                    <div class="quick-actions">
                        <a href="/static/eviction_answer.html" class="quick-action-btn">
                            <i class="bi bi-file-earmark-text"></i>
                            <span>File Answer</span>
                        </a>
                        <a href="/static/counterclaim.html" class="quick-action-btn">
                            <i class="bi bi-arrow-left-right"></i>
                            <span>Counterclaim</span>
                        </a>
                        <a href="/static/court_packet.html" class="quick-action-btn">
                            <i class="bi bi-folder2"></i>
                            <span>Court Packet</span>
                        </a>
                        <a href="/static/hearing_prep.html" class="quick-action-btn">
                            <i class="bi bi-mortarboard"></i>
                            <span>Hearing Prep</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Timeline Tab -->
            <div class="panel-tab-content" id="tab-timeline">
                <div class="panel-section">
                    <div class="panel-section-title">Case Timeline</div>
                    <div class="mini-timeline" id="panel-timeline">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
            
            <!-- Defenses Tab -->
            <div class="panel-tab-content" id="tab-defenses">
                <div class="panel-section">
                    <div class="panel-section-title">Identified Defenses</div>
                    <div id="panel-defenses">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
            
            <!-- Evidence Tab -->
            <div class="panel-tab-content" id="tab-evidence">
                <div class="panel-section">
                    <div class="panel-section-title">Evidence Summary</div>
                    <div id="panel-evidence">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
            
            <!-- Panel Footer Actions -->
            <div class="d-grid gap-2 mt-4">
                <button class="btn btn-primary" onclick="openCaseDetail()">
                    <i class="bi bi-box-arrow-up-right"></i> Open Full Case
                </button>
                <button class="btn btn-outline-secondary" onclick="editCase()">
                    <i class="bi bi-pencil"></i> Edit Case
                </button>
            </div>
        </div>
    </div>
    
    <!-- New Case Modal -->
    <div class="modal fade" id="newCaseModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-plus-circle"></i> Create New Case
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="new-case-form">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Case Number</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="case-number" placeholder="e.g., 27-CV-24-12345" required>
                                    <button class="btn btn-outline-primary" type="button" onclick="lookupCaseNumber()" title="Lookup existing case">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                                <div class="form-text">From your summons/complaint - Click search to auto-fill from existing case</div>
                                <div id="case-lookup-status" class="form-text text-success" style="display: none;"></div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Case Type</label>
                                <select class="form-select" id="case-type" required>
                                    <option value="eviction_defense">Eviction Defense</option>
                                    <option value="counter_claim">Counter Claim</option>
                                    <option value="habitability">Habitability</option>
                                    <option value="discrimination">Discrimination</option>
                                    <option value="retaliation">Retaliation</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Court</label>
                                <input type="text" class="form-control" id="case-court" placeholder="e.g., Dakota County District Court" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Hearing Date</label>
                                <input type="date" class="form-control" id="case-hearing-date">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Property Address</label>
                                <input type="text" class="form-control" id="case-property" placeholder="Full address of rental property" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Plaintiff (Landlord/Property Manager)</label>
                                <input type="text" class="form-control" id="case-plaintiff" placeholder="Name from complaint">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Defendant (You)</label>
                                <input type="text" class="form-control" id="case-defendant" placeholder="Your name as listed">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Monthly Rent</label>
                                <input type="number" class="form-control" id="case-rent" placeholder="$0.00">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Security Deposit</label>
                                <input type="number" class="form-control" id="case-deposit" placeholder="$0.00">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Lease Start</label>
                                <input type="date" class="form-control" id="case-lease-start">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Lease End</label>
                                <input type="date" class="form-control" id="case-lease-end">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Notes</label>
                                <textarea class="form-control" id="case-notes" rows="3" placeholder="Any initial notes about the case..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createCase()">
                        <i class="bi bi-check-lg"></i> Create Case
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/shared-nav.js"></script>
    <script>
        // State
        let cases = [];
        let currentView = 'grid';
        let selectedCaseId = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            SemptifyNav.init();
            loadCases();
            checkUrlParams();
        });
        
        // Check URL parameters for pre-fill
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const caseNumber = urlParams.get('case') || urlParams.get('case_number');
            const prefill = urlParams.get('prefill');
            
            if (caseNumber) {
                // Auto-open modal and lookup case
                setTimeout(() => {
                    openNewCaseModal();
                    document.getElementById('case-number').value = caseNumber;
                    lookupCaseNumber();
                }, 500);
            } else if (prefill === 'true') {
                // Just open modal
                setTimeout(() => openNewCaseModal(), 500);
            }
        }
        
        // Lookup case by case number and auto-fill form
        async function lookupCaseNumber() {
            const caseNumber = document.getElementById('case-number').value.trim();
            const statusEl = document.getElementById('case-lookup-status');
            
            if (!caseNumber) {
                statusEl.style.display = 'none';
                return;
            }
            
            statusEl.innerHTML = '<i class="bi bi-hourglass-split"></i> Looking up case...';
            statusEl.className = 'form-text text-info';
            statusEl.style.display = 'block';
            
            try {
                // Try to fetch existing case by case number/ID
                const response = await fetch(`/api/case-builder/cases/${encodeURIComponent(caseNumber)}`);
                
                if (response.ok) {
                    const caseData = await response.json();
                    populateFormFromCase(caseData);
                    statusEl.innerHTML = '<i class="bi bi-check-circle"></i> Found existing case - form populated!';
                    statusEl.className = 'form-text text-success';
                } else {
                    // Not found - check if we have it in the loaded cases list
                    const localCase = cases.find(c => 
                        c.case_number === caseNumber || 
                        c.id === caseNumber ||
                        c.case_number?.toLowerCase() === caseNumber.toLowerCase()
                    );
                    
                    if (localCase) {
                        // Fetch full case data
                        const fullResponse = await fetch(`/api/case-builder/cases/${encodeURIComponent(localCase.id)}`);
                        if (fullResponse.ok) {
                            const fullCase = await fullResponse.json();
                            populateFormFromCase(fullCase);
                            statusEl.innerHTML = '<i class="bi bi-check-circle"></i> Found existing case - form populated!';
                            statusEl.className = 'form-text text-success';
                        } else {
                            statusEl.innerHTML = '<i class="bi bi-info-circle"></i> New case number - fill in details below';
                            statusEl.className = 'form-text text-muted';
                        }
                    } else {
                        statusEl.innerHTML = '<i class="bi bi-info-circle"></i> New case number - fill in details below';
                        statusEl.className = 'form-text text-muted';
                    }
                }
            } catch (error) {
                console.error('Error looking up case:', error);
                statusEl.innerHTML = '<i class="bi bi-info-circle"></i> New case - fill in details below';
                statusEl.className = 'form-text text-muted';
            }
        }
        
        // Populate form fields from case data
        function populateFormFromCase(caseData) {
            // Basic case info
            if (caseData.case_type) {
                document.getElementById('case-type').value = caseData.case_type;
            }
            if (caseData.court) {
                document.getElementById('case-court').value = caseData.court;
            }
            if (caseData.property_address) {
                document.getElementById('case-property').value = caseData.property_address;
            }
            
            // Parties
            const plaintiffName = caseData.plaintiff?.name || caseData.plaintiff_name;
            if (plaintiffName) {
                document.getElementById('case-plaintiff').value = plaintiffName;
            }
            const defendantName = caseData.defendant?.name || caseData.defendant_name;
            if (defendantName) {
                document.getElementById('case-defendant').value = defendantName;
            }
            
            // Financial
            if (caseData.rent_amount) {
                document.getElementById('case-rent').value = caseData.rent_amount;
            }
            if (caseData.security_deposit) {
                document.getElementById('case-deposit').value = caseData.security_deposit;
            }
            
            // Dates
            if (caseData.hearing_date) {
                document.getElementById('case-hearing-date').value = caseData.hearing_date.split('T')[0];
            }
            if (caseData.lease_start) {
                document.getElementById('case-lease-start').value = caseData.lease_start.split('T')[0];
            }
            if (caseData.lease_end) {
                document.getElementById('case-lease-end').value = caseData.lease_end.split('T')[0];
            }
            
            // Notes
            if (caseData.notes && caseData.notes.length > 0) {
                const notesText = Array.isArray(caseData.notes) ? caseData.notes.join('\n') : caseData.notes;
                document.getElementById('case-notes').value = notesText;
            }
            
            console.log('Form populated from case:', caseData);
        }
        
        // Load cases from API
        async function loadCases() {
            try {
                const response = await fetch('/api/case-builder/cases');
                if (response.ok) {
                    const data = await response.json();
                    cases = data.cases || [];
                    renderCases();
                    updateStats();
                } else {
                    // Show demo data if no cases exist
                    cases = getDemoCases();
                    renderCases();
                    updateStats();
                }
            } catch (error) {
                console.error('Error loading cases:', error);
                // Show demo data on error
                cases = getDemoCases();
                renderCases();
                updateStats();
            }
        }
        
        // Demo data for preview
        function getDemoCases() {
            return [
                {
                    id: 'case-1',
                    case_number: '27-CV-24-12345',
                    case_type: 'eviction_defense',
                    status: 'active',
                    court: 'Dakota County District Court',
                    property_address: '123 Main Street, Apt 4B',
                    plaintiff_name: 'ABC Property Management',
                    defendant_name: 'John Doe',
                    hearing_date: '2025-01-15',
                    progress: 65,
                    next_deadline: '2024-12-20',
                    next_deadline_task: 'File Answer',
                    urgent: true,
                    defenses: ['improper_notice', 'habitability'],
                    evidence_count: 12,
                    timeline_events: [
                        { date: '2024-12-10', title: 'Summons Received' },
                        { date: '2024-12-05', title: 'Notice Posted' },
                        { date: '2024-11-15', title: 'Repair Request Submitted' }
                    ]
                },
                {
                    id: 'case-2',
                    case_number: '27-CV-24-98765',
                    case_type: 'counter_claim',
                    status: 'filed',
                    court: 'Dakota County District Court',
                    property_address: '456 Oak Avenue',
                    plaintiff_name: 'XYZ Holdings LLC',
                    defendant_name: 'Jane Smith',
                    hearing_date: '2025-02-01',
                    progress: 85,
                    next_deadline: '2025-01-25',
                    next_deadline_task: 'Prepare for Hearing',
                    urgent: false,
                    defenses: ['retaliation', 'discrimination'],
                    evidence_count: 24,
                    timeline_events: [
                        { date: '2024-12-15', title: 'Answer Filed' },
                        { date: '2024-12-01', title: 'Evidence Compiled' }
                    ]
                },
                {
                    id: 'case-3',
                    case_number: '27-CV-24-55555',
                    case_type: 'habitability',
                    status: 'draft',
                    court: 'Hennepin County District Court',
                    property_address: '789 Pine Road',
                    plaintiff_name: 'Metro Apartments Inc',
                    defendant_name: 'Bob Johnson',
                    hearing_date: null,
                    progress: 25,
                    next_deadline: '2024-12-22',
                    next_deadline_task: 'Complete Case Setup',
                    urgent: false,
                    defenses: ['habitability'],
                    evidence_count: 5,
                    timeline_events: [
                        { date: '2024-12-14', title: 'Case Created' }
                    ]
                }
            ];
        }
        
        // Render cases in current view
        function renderCases() {
            const filteredCases = getFilteredCases();
            
            if (filteredCases.length === 0) {
                document.getElementById('cases-grid').style.display = 'none';
                document.getElementById('cases-table').classList.remove('active');
                document.getElementById('empty-state').style.display = 'block';
                return;
            }
            
            document.getElementById('empty-state').style.display = 'none';
            
            if (currentView === 'grid') {
                document.getElementById('cases-grid').style.display = 'grid';
                document.getElementById('cases-table').classList.remove('active');
                renderGridView(filteredCases);
            } else {
                document.getElementById('cases-grid').style.display = 'none';
                document.getElementById('cases-table').classList.add('active');
                renderTableView(filteredCases);
            }
        }
        
        // Render grid view
        function renderGridView(casesToRender) {
            const grid = document.getElementById('cases-grid');
            grid.innerHTML = casesToRender.map(c => `
                <div class="case-card" onclick="openCasePanel('${c.id}')">
                    <div class="case-card-header">
                        <span class="case-number">${c.case_number}</span>
                        <span class="case-status ${c.status}">${formatStatus(c.status)}</span>
                    </div>
                    <div class="case-title">${formatCaseType(c.case_type)} â€¢ ${c.plaintiff_name}</div>
                    <div class="case-meta">
                        <span class="case-meta-item">
                            <i class="bi bi-building"></i> ${c.court}
                        </span>
                        <span class="case-meta-item">
                            <i class="bi bi-geo-alt"></i> ${c.property_address}
                        </span>
                    </div>
                    <div class="case-progress">
                        <div class="progress-label">
                            <span>Progress</span>
                            <span>${c.progress}%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: ${c.progress}%"></div>
                        </div>
                    </div>
                    <div class="case-footer">
                        ${c.next_deadline ? `
                            <span class="case-deadline ${c.urgent ? 'urgent' : ''}">
                                <i class="bi bi-calendar-event"></i>
                                ${formatDate(c.next_deadline)} - ${c.next_deadline_task}
                            </span>
                        ` : '<span></span>'}
                        <div class="case-actions" onclick="event.stopPropagation()">
                            <button class="case-action-btn" onclick="editCase('${c.id}')" title="Edit">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="case-action-btn" onclick="deleteCase('${c.id}')" title="Delete">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Render table view
        function renderTableView(casesToRender) {
            const tbody = document.getElementById('cases-table-body');
            tbody.innerHTML = casesToRender.map(c => `
                <tr onclick="openCasePanel('${c.id}')" style="cursor: pointer;">
                    <td><strong>${c.case_number}</strong></td>
                    <td>${formatCaseType(c.case_type)}</td>
                    <td><span class="case-status ${c.status}">${formatStatus(c.status)}</span></td>
                    <td>${c.court}</td>
                    <td class="${c.urgent ? 'text-danger' : ''}">${c.next_deadline ? formatDate(c.next_deadline) : '-'}</td>
                    <td>
                        <div class="progress-bar-container" style="width: 100px;">
                            <div class="progress-bar-fill" style="width: ${c.progress}%"></div>
                        </div>
                    </td>
                    <td onclick="event.stopPropagation()">
                        <button class="case-action-btn" onclick="editCase('${c.id}')" title="Edit">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="case-action-btn" onclick="deleteCase('${c.id}')" title="Delete">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // Update stats
        function updateStats() {
            const active = cases.filter(c => c.status === 'active').length;
            const pending = cases.filter(c => c.status === 'draft' || c.status === 'filed').length;
            const urgent = cases.filter(c => c.urgent).length;
            const closed = cases.filter(c => c.status === 'closed').length;
            
            document.getElementById('stat-active').textContent = active;
            document.getElementById('stat-pending').textContent = pending;
            document.getElementById('stat-urgent').textContent = urgent;
            document.getElementById('stat-closed').textContent = closed;
        }
        
        // Filter cases
        function getFilteredCases() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;
            const typeFilter = document.getElementById('type-filter').value;
            
            return cases.filter(c => {
                const matchesSearch = !search || 
                    c.case_number.toLowerCase().includes(search) ||
                    c.plaintiff_name.toLowerCase().includes(search) ||
                    c.property_address.toLowerCase().includes(search);
                const matchesStatus = !statusFilter || c.status === statusFilter;
                const matchesType = !typeFilter || c.case_type === typeFilter;
                
                return matchesSearch && matchesStatus && matchesType;
            });
        }
        
        function filterCases() {
            renderCases();
        }
        
        // View toggle
        function setView(view) {
            currentView = view;
            document.getElementById('view-grid').classList.toggle('active', view === 'grid');
            document.getElementById('view-table').classList.toggle('active', view === 'table');
            renderCases();
        }
        
        // Open case panel
        function openCasePanel(caseId) {
            selectedCaseId = caseId;
            const caseData = cases.find(c => c.id === caseId);
            if (!caseData) return;
            
            // Set as active case in CaseContext for cross-page access
            CaseContext.setActiveCase({
                case_number: caseData.case_number,
                case_type: caseData.case_type,
                status: caseData.status,
                court: caseData.court,
                property_address: caseData.property_address,
                plaintiff: { name: caseData.plaintiff_name },
                defendant: { name: caseData.defendant_name },
                hearing_date: caseData.hearing_date,
                rent_amount: caseData.rent_amount,
                security_deposit: caseData.security_deposit,
                progress: caseData.progress,
                defenses: caseData.defenses,
                evidence_count: caseData.evidence_count
            });
            console.log('ðŸ“‹ Set active case:', caseData.case_number);
            
            // Populate panel
            document.getElementById('panel-case-number').textContent = `Case #${caseData.case_number}`;
            document.getElementById('panel-case-type').textContent = formatCaseType(caseData.case_type);
            document.getElementById('panel-status').textContent = formatStatus(caseData.status);
            document.getElementById('panel-status').className = `case-status ${caseData.status}`;
            document.getElementById('panel-progress-text').textContent = `${caseData.progress}% Complete`;
            document.getElementById('panel-progress-bar').style.width = `${caseData.progress}%`;
            document.getElementById('panel-court').textContent = caseData.court;
            document.getElementById('panel-hearing').textContent = caseData.hearing_date ? formatDate(caseData.hearing_date) : 'Not scheduled';
            document.getElementById('panel-plaintiff').textContent = caseData.plaintiff_name;
            document.getElementById('panel-property').textContent = caseData.property_address;
            
            // Urgent alert
            const urgentAlert = document.getElementById('panel-urgent-alert');
            if (caseData.urgent) {
                urgentAlert.style.display = 'flex';
                document.getElementById('panel-urgent-message').textContent = 
                    `${caseData.next_deadline_task} by ${formatDate(caseData.next_deadline)}`;
            } else {
                urgentAlert.style.display = 'none';
            }
            
            // Timeline
            const timelineHtml = (caseData.timeline_events || []).map(e => `
                <div class="timeline-item">
                    <div class="timeline-date">${formatDate(e.date)}</div>
                    <div class="timeline-title">${e.title}</div>
                </div>
            `).join('');
            document.getElementById('panel-timeline').innerHTML = timelineHtml || '<p class="text-muted">No timeline events yet</p>';
            
            // Defenses
            const defensesHtml = (caseData.defenses || []).map(d => `
                <div class="defense-item">
                    <div class="defense-strength strong"></div>
                    <div>
                        <div class="fw-semibold">${formatDefense(d)}</div>
                        <small class="text-muted">Applicable defense</small>
                    </div>
                </div>
            `).join('');
            document.getElementById('panel-defenses').innerHTML = defensesHtml || '<p class="text-muted">No defenses identified yet</p>';
            
            // Evidence
            document.getElementById('panel-evidence').innerHTML = `
                <div class="d-flex align-items-center gap-3 mb-3">
                    <div class="stat-icon active" style="width: 40px; height: 40px; font-size: 1rem;">
                        <i class="bi bi-file-earmark"></i>
                    </div>
                    <div>
                        <h4 class="mb-0">${caseData.evidence_count || 0}</h4>
                        <small class="text-muted">Evidence Items</small>
                    </div>
                </div>
                <a href="/static/briefcase.html" class="btn btn-outline-light btn-sm">
                    <i class="bi bi-folder"></i> View in Briefcase
                </a>
            `;
            
            // Show panel
            document.getElementById('panel-overlay').classList.add('show');
            document.getElementById('case-panel').classList.add('open');
            
            // Reset to overview tab
            showPanelTab('overview');
        }
        
        function closePanel() {
            document.getElementById('panel-overlay').classList.remove('show');
            document.getElementById('case-panel').classList.remove('open');
            selectedCaseId = null;
        }
        
        function showPanelTab(tabName) {
            document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.panel-tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`.panel-tab[onclick="showPanelTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }
        
        // Modal functions
        function openNewCaseModal() {
            const modal = new bootstrap.Modal(document.getElementById('newCaseModal'));
            modal.show();
            
            // Check if there's an active case to pre-fill from
            const activeCase = CaseContext.getActiveCase();
            if (activeCase && !document.getElementById('case-number').value) {
                populateFormFromCase(activeCase);
            }
        }
        
        async function createCase() {
            const caseData = {
                case_number: document.getElementById('case-number').value,
                case_type: document.getElementById('case-type').value,
                court: document.getElementById('case-court').value,
                property_address: document.getElementById('case-property').value,
                plaintiff_name: document.getElementById('case-plaintiff').value,
                defendant_name: document.getElementById('case-defendant').value,
                rent_amount: parseFloat(document.getElementById('case-rent').value) || 0,
                security_deposit: parseFloat(document.getElementById('case-deposit').value) || 0,
                hearing_date: document.getElementById('case-hearing-date').value || null,
                lease_start: document.getElementById('case-lease-start').value || null,
                lease_end: document.getElementById('case-lease-end').value || null,
                notes: document.getElementById('case-notes').value
            };
            
            try {
                const response = await fetch('/api/case-builder/cases', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(caseData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // Set as active case in CaseContext
                    CaseContext.setActiveCase({
                        case_number: caseData.case_number,
                        case_type: caseData.case_type,
                        court: caseData.court,
                        property_address: caseData.property_address,
                        plaintiff: { name: caseData.plaintiff_name },
                        defendant: { name: caseData.defendant_name },
                        rent_amount: caseData.rent_amount,
                        security_deposit: caseData.security_deposit,
                        hearing_date: caseData.hearing_date,
                        lease_start: caseData.lease_start,
                        lease_end: caseData.lease_end,
                        notes: caseData.notes ? [caseData.notes] : [],
                        status: 'draft'
                    });
                    console.log('ðŸ“‹ Created and set active case:', caseData.case_number);
                    
                    bootstrap.Modal.getInstance(document.getElementById('newCaseModal')).hide();
                    document.getElementById('new-case-form').reset();
                    loadCases();
                    showToast('Case created successfully!', 'success');
                } else {
                    const error = await response.json();
                    showToast(error.detail || 'Failed to create case', 'error');
                }
            } catch (error) {
                console.error('Error creating case:', error);
                showToast('Error creating case', 'error');
            }
        }
        
        function editCase(caseId) {
            // Set case as active before navigating
            const caseData = cases.find(c => c.id === caseId);
            if (caseData) {
                CaseContext.setActiveCase({
                    case_number: caseData.case_number,
                    case_type: caseData.case_type,
                    court: caseData.court,
                    property_address: caseData.property_address,
                    plaintiff: { name: caseData.plaintiff_name },
                    defendant: { name: caseData.defendant_name },
                    status: caseData.status
                });
            }
            // Navigate to case builder with case ID
            window.location.href = `/static/case_builder.html?case=${caseId}`;
        }
        
        async function deleteCase(caseId) {
            if (!confirm('Are you sure you want to delete this case? This cannot be undone.')) return;
            
            try {
                const response = await fetch(`/api/case-builder/cases/${caseId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    loadCases();
                    closePanel();
                    showToast('Case deleted', 'success');
                }
            } catch (error) {
                console.error('Error deleting case:', error);
            }
        }
        
        function openCaseDetail() {
            if (selectedCaseId) {
                window.location.href = `/static/case_detail.html?case=${selectedCaseId}`;
            }
        }
        
        // Formatters
        function formatStatus(status) {
            const labels = {
                active: 'Active',
                draft: 'Draft',
                filed: 'Filed',
                closed: 'Closed'
            };
            return labels[status] || status;
        }
        
        function formatCaseType(type) {
            const labels = {
                eviction_defense: 'Eviction Defense',
                counter_claim: 'Counter Claim',
                habitability: 'Habitability',
                discrimination: 'Discrimination',
                retaliation: 'Retaliation',
                other: 'Other'
            };
            return labels[type] || type;
        }
        
        function formatDefense(defense) {
            const labels = {
                improper_notice: 'Improper Notice',
                habitability: 'Breach of Habitability',
                retaliation: 'Retaliatory Eviction',
                discrimination: 'Discrimination',
                waiver: 'Waiver',
                landlord_breach: 'Landlord Breach'
            };
            return labels[defense] || defense;
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
        
        function showToast(message, type = 'info') {
            // Simple toast notification
            const toast = document.createElement('div');
            toast.className = `alert alert-${type === 'error' ? 'danger' : type} position-fixed`;
            toast.style.cssText = 'bottom: 20px; right: 20px; z-index: 10001; animation: fadeIn 0.3s ease;';
            toast.innerHTML = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
    
    <!-- Help System -->
    <script src="/static/js/help-system.js"></script>
    <script src="/static/js/semptify-auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof SemptifyHelp !== 'undefined') {
                SemptifyHelp.init('cases');
            }
        });
    </script>
</body>
</html>
